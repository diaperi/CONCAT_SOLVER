<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>mainPage</title>
    <script src="https://kit.fontawesome.com/a06d7ad725.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" th:href="@{/hyeeun/css/mainpage.css}">
    <link rel="stylesheet" th:href="@{/hyeeun/css/header.css}">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

</head>
<body>
<div th:replace="hyeeun/header :: header"></div>

<div class="myPageDetail_container">
    <div class="myPageDetail_container2">
        <div class="myPageDetail_main">
            <div class="myPageDetail_videoBox slide-out-left" id="videoBox">
                <!--                    <img id="video" src="http://192.168.137.227:5000/video_feed" width="640" height="480">-->
                <img id="video" th:src="${videoFeedUrl}">
                <span class="close-button" id="closeButton"><i class="fa-solid fa-x"></i></span>
            </div>
            <div class="myPageDetail_rightBox visible" id="myPageDetail_rightBox">
                <div class="myPageDetail_rightTop">
                    <span>ëŒ€í™”ë‚´ìš©</span>
                    <span id="solveBtn">í•´ê²°ì±…</span>
                    <span id="expandButton"><i class="fa-solid fa-angles-left"></i></span>
                </div>
                <div class="myPageDetail_rightMain">
                    <span id="transcriptResult">ëŒ€í™” ë‚´ìš©ì„ ë³´ì—¬ë“œë¦´ê²Œìš”.<br><br>ì¡°ê¸ˆë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”.ğŸ˜€</span>
                </div>
                <div class="myPageDetail_rightMain">
                    <span id="gptResult">ì†”ë²„ê°€ í•´ê²°ì±…ì„ ë§Œë“¤ê³  ìˆì–´ìš”.<br><br>ì¡°ê¸ˆë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”.ğŸ«¡</span>
                </div>
            </div>
        </div>
    </div>
</div>


<script src="/seoyun/js/myPageDetail.js"></script>
<script th:inline="javascript">
    var userId = /*[[${userId}]]*/ 'defaultUserId'; // userId ê°’ì´ ì œëŒ€ë¡œ ì„¤ì •ë˜ì—ˆëŠ”ì§€ í™•ì¸
    console.log("User ID: ", userId); // ì´ ì¤„ì„ ì¶”ê°€í•´ userId ê°’ì´ ì œëŒ€ë¡œ ì¶œë ¥ë˜ëŠ”ì§€ ì½˜ì†”ì—ì„œ í™•ì¸
</script>
<script>
    function fetchLatestResults() {
        if (!userId || userId === 'defaultUserId') {
            console.error("Invalid userId detected: ", userId);
            return;
        }
        $.ajax({
            url    : "/api/s3/latest-transcript",
            type   : "GET",
            data   : {userId: userId}, // userId ë³€ìˆ˜ë¥¼ ì‚¬ìš©
            success: function (response) {
                const formattedResponse = response.replace(/ì°¸ì—¬ì/g, '<br>ì°¸ì—¬ì');
                $("#transcriptResult").html(formattedResponse); // ìµœì‹  í™”ìì¸ì‹ ê²°ê³¼
            },
            error  : function () {
                console.log("í™”ìì¸ì‹ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
            }
        });

        $.ajax({
            url    : "/api/s3/latest-gpt-response",
            type   : "GET",
            data   : {userId: userId}, // userId ë³€ìˆ˜ë¥¼ ì‚¬ìš©
            success: function (response) {
                // í…ìŠ¤íŠ¸ì— <br> íƒœê·¸ ì¶”ê°€
                const formattedResponse = response.replace(/\./g, '.');
                $("#gptResult").html(formattedResponse); // ìµœì‹  GPT ê²°ê³¼
            },
            error  : function () {
                console.log("GPT ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
            }
        });
    }

    // ì¼ì • ê°„ê²©ìœ¼ë¡œ S3 ë°ì´í„° ì²´í¬
    setInterval(fetchLatestResults, 5000); // 5ì´ˆë§ˆë‹¤ ìµœì‹  ë°ì´í„° ì²´í¬
</script>


</body>
</html>